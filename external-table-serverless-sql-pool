Serverless SQL Pool
Serverless SQL Pool queries external data (structured or semi-structured like CSV, Parquet, or JSON) directly from Azure Data Lake without storing it.

To access data, we can use OPENROWSET() or External Table.

Why we create a database in Serverless SQL Pool?
Even though Serverless SQL Pool does not store data, it still needs a logical database to store metadata and object definitions — not the actual data.

Flow to create External Table:
1. create DATABASE (storage for metadata)
2. create MASTER KEY (Encrypts secrets) (one time per db)
3. create DATABASE SCOPED CREDENTIAL (Stores secrets securely)
4. create EXTERNAL DATA SOURCE (Uses credentials for access)
5. create EXTERNAL FILE FORMAT
6. create EXTERNAL TABLE (Reads data using the data source)a

                       +-----------------------+
                       |  Synapse Workspace    |
                       |  Serverless SQL Pool  |
                       +----------+------------+
                                  |
        ------------------------------------------------------
        |                                                    |
  Default Storage Account                               External Storage Account
  (created with workspace)                              (any other ADLS/Blob)
        |                                                    |
    Access methods                                        Access methods
        |                                                    |
  -----------------------                                 ---------------------------
  |                     |                                 |                         |
Managed Identity     SAS Token                          Managed Identity         SAS Token
                       /Storage Account Access Key                                /Storage Account Access Key
                       /Service Principal                                         /Service Principal
  |                     |                                 |                     |
  |                     |                                 |                     |
Master Key ❌      Master Key ✅                     Master Key ❌           Master Key ✅
Credential ❌      Credential ✅                     Credential ❌           Credential ✅
Query: OPENROWSET, EXTERNAL TABLE           Query: OPENROWSET, EXTERNAL TABLE

Steps to create External Table:

1. Create Database (not a physical database, logical database is created to store metadata)
CREATE DATABASE myserverlessdb;
USE myserverlessdb;



2. Create MASTER KEY (not required if we use default Managed Identity)(encryption foundation)
CREATE MASTER KEY ENCRYPTION BY PASSWORD = 'YourStrongPassword123!';



3. Create DATABASE SCOPED CREDENTIAL (optional for Managed Identity, required for all other)(stores external access secrets)
types:
for Managed Identity:
CREATE DATABASE SCOPED CREDENTIAL MyStorageCredential
WITH IDENTITY = 'Managed Identity';

for SAS Token:
CREATE DATABASE SCOPED CREDENTIAL <credential name>
WITH IDENTITY = 'SHARED ACCESS SIGNATURE',
SECRET = '<your_storage_account_key>';

for service principal:
CREATE DATABASE SCOPED CREDENTIAL <service_principal_credential>
WITH IDENTITY = '<your_appilication_id@https://login.microsoftonline.com/<Your-Tenant-ID>/oauth2/token>',
SECRET = 'your_client_secret';



4. Create EXTERNAL DATA SOURCE (Create External Data Source (uses the credential))
CREATE EXTERNAL DATA SOURCE MyExternalDataSource
WITH (
    LOCATION = 'https://<storageaccount>.dfs.core.windows.net/<container>',
    CREDENTIAL = MyStorageCredential
);



5. Create EXTERNAL FILE FORMAT
for Parquet:
CREATE EXTERNAL FILE FORMAT ParquetFileFormat
WITH (
    FORMAT_TYPE = PARQUET
);

for CSV:
CREATE EXTERNAL FILE FORMAT CsvFileFormat
WITH (
    FORMAT_TYPE = DELIMITEDTEXT,
    FORMAT_OPTIONS (
        FIELD_TERMINATOR = ',',
        STRING_DELIMITER = '"',
        FIRST_ROW = 2
    )
);

6. Create EXTERNAL TABLE
for Parquet:
CREATE EXTERNAL TABLE dbo.ParquetSalesData
(
    SaleID INT,
    ProductName VARCHAR(100),
    Quantity INT,
    SaleDate DATE
)
WITH (
    LOCATION = '/data/parquet/sales/',
    DATA_SOURCE = MyExternalDataSource,
    FILE_FORMAT = ParquetFileFormat
);

for CSV:
CREATE EXTERNAL TABLE dbo.CsvSalesData
(
    SaleID INT,
    ProductName VARCHAR(100),
    Quantity INT,
    SaleDate DATE
)
WITH (
    LOCATION = '/data/csv/sales/',
    DATA_SOURCE = MyExternalDataSource,
    FILE_FORMAT = CsvFileFormat
);



7. query the External Tables:
SELECT * FROM dbo.ParquetSalesData;
SELECT * FROM dbo.CsvSalesData;




























